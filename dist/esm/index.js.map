{"version":3,"file":"index.js","sources":["../../src/index.ts"],"sourcesContent":["import type { Plugin } from 'flatpickr/dist/types/options';\nimport type { Instance } from 'flatpickr/dist/types/instance';\n\n/**\n * Autocomplete attribute names to transfer\n */\nconst AUTOCOMPLETE_ATTRIBUTES = ['autocomplete', 'aria-autocomplete'] as const;\n\ntype AutocompleteAttribute = (typeof AUTOCOMPLETE_ATTRIBUTES)[number];\n\n/**\n * Safely transfers an attribute from source element to target element\n *\n * @param sourceElement - The element to read the attribute from\n * @param targetElement - The element to set the attribute on\n * @param attributeName - The name of the attribute to transfer\n * @returns true if the attribute was transferred, false otherwise\n */\nfunction transferAttribute(\n  sourceElement: HTMLElement,\n  targetElement: HTMLElement | undefined,\n  attributeName: AutocompleteAttribute\n): boolean {\n  if (!targetElement) {\n    return false;\n  }\n\n  try {\n    const value = sourceElement.getAttribute(attributeName);\n    if (value !== null) {\n      sourceElement.removeAttribute(attributeName);\n      targetElement.setAttribute(attributeName, value);\n      return true;\n    }\n  } catch (error) {\n    // Silently fail - DOM manipulation errors shouldn't break the plugin\n    if (process.env.NODE_ENV !== 'production') {\n      console.warn(\n        `Failed to transfer attribute \"${attributeName}\":`,\n        error\n      );\n    }\n  }\n\n  return false;\n}\n\n/**\n * Gets the target input element where autocomplete attributes should be applied\n *\n * @param fp - The flatpickr instance\n * @returns The target input element (mobileInput or altInput), or undefined\n */\nfunction getTargetInput(fp: Instance): HTMLElement | undefined {\n  return fp.mobileInput || fp.altInput || undefined;\n}\n\n/**\n * Processes autocomplete attributes after flatpickr is ready\n *\n * @param fp - The flatpickr instance\n */\nfunction processAutocompleteAttributes(fp: Instance): void {\n  // Ensure the input element exists\n  if (!fp.input) {\n    if (process.env.NODE_ENV !== 'production') {\n      console.warn('Flatpickr input element not found');\n    }\n    return;\n  }\n\n  const targetInput = getTargetInput(fp);\n  if (!targetInput) {\n    // No alternate input to transfer to, skip processing\n    return;\n  }\n\n  // Transfer each autocomplete attribute\n  for (const attribute of AUTOCOMPLETE_ATTRIBUTES) {\n    transferAttribute(fp.input, targetInput, attribute);\n  }\n}\n\n/**\n * Creates a flatpickr plugin that controls autocomplete attributes\n *\n * This plugin transfers `autocomplete` and `aria-autocomplete` attributes\n * from the original input element to flatpickr's mobile or alternate input.\n * This is useful for controlling browser autocomplete behavior on the actual\n * visible input element.\n *\n * @example\n * ```typescript\n * import flatpickr from 'flatpickr';\n * import autocompletePlugin from 'flatpickr-autocomplete-plugin';\n *\n * flatpickr('#myInput', {\n *   plugins: [autocompletePlugin()]\n * });\n * ```\n *\n * @example\n * ```html\n * <!-- In your HTML -->\n * <input\n *   id=\"myInput\"\n *   autocomplete=\"off\"\n *   aria-autocomplete=\"none\"\n * />\n * ```\n *\n * @returns A flatpickr plugin instance\n */\nexport default function autocompletePlugin(): Plugin {\n  return (fp: Instance): { onReady: () => void } => {\n    return {\n      /**\n       * Hook called when flatpickr is fully initialized\n       */\n      onReady(): void {\n        // Use requestAnimationFrame to ensure DOM is fully ready\n        // This is more reliable than setTimeout and doesn't use arbitrary delays\n        requestAnimationFrame(() => {\n          processAutocompleteAttributes(fp);\n\n          // Register plugin in loadedPlugins array\n          if (fp.loadedPlugins && Array.isArray(fp.loadedPlugins)) {\n            fp.loadedPlugins.push('autocompletePlugin');\n          }\n        });\n      },\n    };\n  };\n}\n"],"names":[],"mappings":";;;;;;;;AAGA;;AAEG;AACH,MAAM,uBAAuB,GAAG,CAAC,cAAc,EAAE,mBAAmB,CAAU;AAI9E;;;;;;;AAOG;AACH,SAAS,iBAAiB,CACxB,aAA0B,EAC1B,aAAsC,EACtC,aAAoC,EAAA;IAEpC,IAAI,CAAC,aAAa,EAAE;AAClB,QAAA,OAAO,KAAK;IACd;AAEA,IAAA,IAAI;QACF,MAAM,KAAK,GAAG,aAAa,CAAC,YAAY,CAAC,aAAa,CAAC;AACvD,QAAA,IAAI,KAAK,KAAK,IAAI,EAAE;AAClB,YAAA,aAAa,CAAC,eAAe,CAAC,aAAa,CAAC;AAC5C,YAAA,aAAa,CAAC,YAAY,CAAC,aAAa,EAAE,KAAK,CAAC;AAChD,YAAA,OAAO,IAAI;QACb;IACF;IAAE,OAAO,KAAK,EAAE;IAQhB;AAEA,IAAA,OAAO,KAAK;AACd;AAEA;;;;;AAKG;AACH,SAAS,cAAc,CAAC,EAAY,EAAA;IAClC,OAAO,EAAE,CAAC,WAAW,IAAI,EAAE,CAAC,QAAQ,IAAI,SAAS;AACnD;AAEA;;;;AAIG;AACH,SAAS,6BAA6B,CAAC,EAAY,EAAA;;AAEjD,IAAA,IAAI,CAAC,EAAE,CAAC,KAAK,EAAE;QAIb;IACF;AAEA,IAAA,MAAM,WAAW,GAAG,cAAc,CAAC,EAAE,CAAC;IACtC,IAAI,CAAC,WAAW,EAAE;;QAEhB;IACF;;AAGA,IAAA,KAAK,MAAM,SAAS,IAAI,uBAAuB,EAAE;QAC/C,iBAAiB,CAAC,EAAE,CAAC,KAAK,EAAE,WAAW,EAAE,SAAS,CAAC;IACrD;AACF;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BG;AACW,SAAU,kBAAkB,GAAA;IACxC,OAAO,CAAC,EAAY,KAA6B;QAC/C,OAAO;AACL;;AAEG;YACH,OAAO,GAAA;;;gBAGL,qBAAqB,CAAC,MAAK;oBACzB,6BAA6B,CAAC,EAAE,CAAC;;AAGjC,oBAAA,IAAI,EAAE,CAAC,aAAa,IAAI,KAAK,CAAC,OAAO,CAAC,EAAE,CAAC,aAAa,CAAC,EAAE;AACvD,wBAAA,EAAE,CAAC,aAAa,CAAC,IAAI,CAAC,oBAAoB,CAAC;oBAC7C;AACF,gBAAA,CAAC,CAAC;YACJ,CAAC;SACF;AACH,IAAA,CAAC;AACH;;;;"}